// import { chain } from "./middlewares/chain";
import auth from "@/middlewares/middleware1"
import { withMiddleware2 } from "./middlewares/middleware2";
import { NextMiddleware, NextResponse } from "next/server";




export const middleware = chain([withMiddleware2]);
// export default auth
const functions = [auth]



// type MiddlewareFactory = (middleware: NextMiddleware) => NextMiddleware


function chain(functions, index=0) {
    const current = functions[index]

    if(current){
        const next = chain(functions, index+1)
        return current(next)
    }

    return () => NextResponse.next()
}

// export default chain(functions)



export const config = {
    matcher: [
        "/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)",
        // "/"
    ], // karkoli je v tej routi, bo invokal middleware (auth fukcijo v tem primeru)
};











// import {authConfig} from "./authConfig";
// import NextAuth from "next-auth";
// import {
//     DEFAULT_LOGIN_REDIRECT,
//     apiAuthPrefix,
//     // publicRoutes,
//     authRoutes,
// } from "@/routes";
// import { authConfig } from "./app/_lib/auth.config";
// import { request } from "http";
// import { NextRequest, NextResponse } from "next/server";

// const { auth } = NextAuth(authConfig);

// export default auth(authCallback)
// export default auth((req) => {
//     const { nextUrl } = req;
//     const isLoggedIn = !!req.auth;
//     // const isLoggedIn = false;
//     console.log("ROUTE:", req.nextUrl.pathname);
//     console.log("IS LOGGED IN:", isLoggedIn);

//     const isApiAuthPrefix = nextUrl.pathname.startsWith(apiAuthPrefix);
//     // const isPublicRoute = publicRoutes.includes(nextUrl.pathname);
//     const isAuthRoute = authRoutes.includes(nextUrl.pathname);

//     // if(nextUrl.pathname === "/") {
//     //     return Response.redirect(new URL("/auth/login", nextUrl));
//     // }

//     if (isApiAuthPrefix) {
//         return null;
//     }

//     if (!isLoggedIn) {
//         return Response.redirect(new URL("/auth/login", nextUrl));
//     }

//     // if (isAuthRoute) {
//     //     if (isLoggedIn)
//     //         return Response.redirect(new URL(DEFAULT_LOGIN_REDIRECT, nextUrl));
//     //     return null;
//     // }

//     return null;
// });

// function authCallback(req){
//     const { nextUrl } = req;
//     const isLoggedIn = !!req.auth;
//     // const isLoggedIn = false;
//     console.log("ROUTE:", req.nextUrl.pathname);
//     console.log("IS LOGGED IN:", isLoggedIn);

//     const isApiAuthPrefix = nextUrl.pathname.startsWith(apiAuthPrefix);
//     // const isPublicRoute = publicRoutes.includes(nextUrl.pathname);
//     const isAuthRoute = authRoutes.includes(nextUrl.pathname);

//     // if(nextUrl.pathname === "/") {
//     //     return Response.redirect(new URL("/auth/login", nextUrl));
//     // }

//     if (isApiAuthPrefix) {
//         return null;
//     }

//     if (!isLoggedIn) {
//         return Response.redirect(new URL("/auth/login", nextUrl));
//     }

//     // if (isAuthRoute) {
//     //     if (isLoggedIn)
//     //         return Response.redirect(new URL(DEFAULT_LOGIN_REDIRECT, nextUrl));
//     //     return null;
//     // }

//     return null;
// }



// export function middleware(req: NextRequest) {
//     auth(authCallback)
//     middleware2(req)
// }


// export const { auth: middleware } = NextAuth(authConfig);
